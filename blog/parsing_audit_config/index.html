<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta name="generator" content="Hugo 0.79.0" />
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> Parsing Linux audit config </title>

  
  <meta name="description" content="The linux audit config isn&#39;t too pretty off the wire"> 
  
  
  
  
  

  

  <meta name="author" content="open-osquery">


  <meta property="og:title" content="Parsing Linux audit config" />
<meta property="og:description" content="The linux audit config isn&#39;t too pretty off the wire" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/parsing_audit_config/" />
<meta property="article:published_time" content="2020-11-22T17:14:54+05:30" />
<meta property="article:modified_time" content="2020-11-22T17:14:54+05:30" />

  




  
  
  
  
  

  <link rel="canonical" href="/blog/parsing_audit_config/">  

  <link rel="shortcut icon" type="image/png" href="data:image/png;base64,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RvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3EldwAAAAAAAJJjRvlaOwAAAAAAALXmk3Eld+D/AfhEhmLqHBsfAAAAAElFTkSuQmCC">


  <link href="/css/font.css" rel="stylesheet" type="text/css">
  <link href="/css/kube.min.css" rel="stylesheet" type="text/css">
  <link href="/css/kube.legenda.css" rel="stylesheet" type="text/css">
  <link href="/css/highlight.css" rel="stylesheet" type="text/css">
  <link href="/css/master.css" rel="stylesheet" type="text/css">
  <link href="/css/kube.demo.css" rel="stylesheet" type="text/css">

  <link href="/css/custom.css" rel="stylesheet" type="text/css">
  <link href="/css/syntax.css" rel="stylesheet" type="text/css">

  <script src="/js/jquery-2.1.4.min.js" type="text/javascript">
  </script>

  <script type="text/javascript" src="/js/tocbot.min.js"></script>
</head>


<body class="page-kube">
  <header> <div class="show-sm">
    <div id="nav-toggle-box">
      <div id="nav-toggle-brand">
        <a href="/">Open osquery</a>
      </div><a data-component="toggleme" data-target="#top" href="#" id="nav-toggle"><i class="kube-menu"></i></a>
    </div>
  </div>
  <div class="hide-sm" id="top">
    <div id="top-brand">
      <a href="/" title="home">Open osquery</a>
    </div>
    <nav id="top-nav-main">
      <ul>
       
       
    <li><a href="/about/" >About</a></li>
    
    <li><a href="/blog/" >Blog</a></li>
    
    <li><a href="/docs/" >Docs</a></li>
    
      </ul>
    </nav>
    <nav id="top-nav-extra"> 
      <ul>
          
      </ul>
    </nav>
  </div>
 </header>
  <main>
<div class="push-center" itemscope itemtype="http://schema.org/BlogPosting">
    <meta itemprop="name" content="Parsing Linux audit config">
<meta itemprop="description" content="The linux audit config isn&#39;t too pretty off the wire">
<meta itemprop="datePublished" content="2020-11-22T17:14:54+05:30" />
<meta itemprop="dateModified" content="2020-11-22T17:14:54+05:30" />
<meta itemprop="wordCount" content="1209">



<meta itemprop="keywords" content="" />

<div id="hero">
    <h1 itemprop="headline">  Parsing Linux audit config</h1>
    
<blockquote itemprop="description">The linux audit config isn&#39;t too pretty off the wire</blockquote>

<time class="post-time"><span class="icon">
  <i class="fa fa-clock-o" aria-hidden="true"></i>
</span>
<span>6 minute read</span>
<span class="icon">
 <i class="fa fa-pencil" aria-hidden="true"></i>
</span>

  Published: <time datetime="2020-11-22T17:14:54&#43;05:30">22 Nov, 2020</time>

</time>
</div>
<div id="post-box">
<div id="post" itemprop="articleBody">

    <h2 id="the-linux-audit-framework">The linux audit framework</h2>
<p>The linux audit framework can be seen as a watcher on the events from the
kernel, usually events related to security. It <strong>does not</strong> provide any kind of
security on it&rsquo;s own but just logs everything it&rsquo;s asked to for analysis later.</p>
<p>This article is not going to deal with details on the audit framework and
configuration by itself. There are better resources, for example
<a href="https://wiki.archlinux.org/index.php/Audit_framework">archlinux: Audit Framework</a>
that deal with the configuration with much more accuracy. We will deal with how
to parse the config.</p>
<h2 id="how-does-it-look">How does it look</h2>
<p>Getting the current config that is running on the system is fairly easy, given
you have sufficient permissions.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ auditctl -l
-a always,exit -S execve -F <span class="nv">key</span><span class="o">=</span><span class="nb">exec</span>
-a always,exit -S execveat -F <span class="nv">key</span><span class="o">=</span><span class="nb">exec</span>
</code></pre></div><p>To know more about how to interpret the audit config, i.e. what does that output
for the <code>auditctl -l</code> command mean, you can refer the
<a href="https://linux.die.net/man/8/auditctl"><code>auditctl(8)</code></a> man page.</p>
<p>A 10 second primer would be,</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">-a always,exit -S execve -F auid&gt;<span class="o">=</span><span class="m">1000</span> -F auid!<span class="o">=</span>-1 -k <span class="nb">exec</span>
</code></pre></div><table>
<thead>
<tr>
<th>Token</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-a</code></td>
<td>Add a rule</td>
</tr>
<tr>
<td><code>always,exit</code></td>
<td>Audit always and when the event exits</td>
</tr>
<tr>
<td><code>-S execve</code></td>
<td>syscall execve</td>
</tr>
<tr>
<td><code>-F auid&gt;=1000</code></td>
<td>Add a filter where the user id is &gt;= 1000</td>
</tr>
<tr>
<td><code>-F auid!=-1</code></td>
<td>Add a filter where the user id is not equal to 4294967295</td>
</tr>
<tr>
<td><code>-k exec</code></td>
<td>Label events triggered by this rule with the tag <code>exec</code></td>
</tr>
</tbody>
</table>
<p>This is the string representation of the rules and it can get fairly
complicated. To install this rule, i.e. tell the linux audit framework to log
events that match this rule, a simple <code>auditctl</code> command can be used. Basically
these strings can be passed to the <code>auditctl</code> command and it just works.</p>
<h2 id="how-to-read-it-programatically">How to read it programatically</h2>
<p>The <code>auditctl</code> is just a helper tool that can be executed to interact with the
linux kernel. Doing it natively would make the process much more flexible.</p>
<p>Linux has something called <a href="https://man7.org/linux/man-pages/man7/netlink.7.html"><code>netlink</code></a>
which is a communication mechanism between userspace and the kernel. Its exposed
like any other socket connection. By listening to the right netlink family one
could read certain kind of messages and talk to kernel to configure certain
services, audit being one.</p>
<p>There are a few resources apart from the man page that does a good job in
explaining concepts about netlink. One of the most popular, atleast among
gophers, being <a href="https://github.com/mdlayher">mdlayher</a>&rsquo;s.</p>
<ul>
<li><a href="https://mdlayher.com/blog/linux-netlink-and-go-part-1-netlink/">Linux Netlink and Go - Part 1</a></li>
<li><a href="https://mdlayher.com/blog/linux-netlink-and-go-part-2-generic-netlink">Linux Netlink and Go - Part 2</a></li>
</ul>
<p>The third part is too specific which may not be needed in this context.</p>
<p>In essence if you connect to the <code>NETLINK_AUDIT</code> family, we should be able to
interact with the Audit framework. For simplicity, we shall be dealing with a
higher level API instead of wrangling bytes and piecing out the messages (for
now). We shall use a fantastic library <a href="https://github.com/elastic/go-libaudit">elastic/go-libaudit</a>
to interact with the Linux Framework. This is a go port (not comprehensive) for
the original <a href="https://github.com/linux-audit/audit-userspace">linux-audit/audit-userspace</a>
project that is the most comprehensive and complete (but sadly not very well
documented) library / tool to interact with the linux framework.</p>
<p>A handy reference to keep in mind would be this single file</p>
<ul>
<li><a href="https://github.com/linux-audit/audit-userspace/blob/master/lib/libaudit.h">libaudit.h</a></li>
<li><a href="https://github.com/torvalds/linux/blob/master/include/uapi/linux/audit.h">audit.h</a></li>
</ul>
<h2 id="getting-the-status-of-the-linux-audit-framework">Getting the status of the linux audit framework</h2>
<p>To get the status of the linux audit framework (simulating <code>auditctl -S</code>), we
will need to connect to the <code>NETLINK_AUDIT</code> family of socket and then send a
message of the type <a href="https://github.com/torvalds/linux/blob/master/include/uapi/linux/audit.h#L54"><code>AUDIT_GET</code></a>.</p>
<p>This can be seen from the
<a href="https://github.com/elastic/go-libaudit/blob/6ef937321079058dca6a7da84500568871c5591c/audit.go#L167-L184">go-libaudit code</a></p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// GetStatusAsync sends a request for the status of the kernel&#39;s audit subsystem
</span><span class="c1">// and returns without waiting for a response.
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">AuditClient</span><span class="p">)</span> <span class="nf">GetStatusAsync</span><span class="p">(</span><span class="nx">requireACK</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">seq</span> <span class="kt">uint32</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">flags</span> <span class="kt">uint16</span> <span class="p">=</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">NLM_F_REQUEST</span>
	<span class="k">if</span> <span class="nx">requireACK</span> <span class="p">{</span>
		<span class="nx">flags</span> <span class="o">|=</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">NLM_F_ACK</span>
	<span class="p">}</span>
	<span class="nx">msg</span> <span class="o">:=</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">NetlinkMessage</span><span class="p">{</span>
		<span class="nx">Header</span><span class="p">:</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">NlMsghdr</span><span class="p">{</span>
			<span class="nx">Type</span><span class="p">:</span>  <span class="nx">AuditGet</span><span class="p">,</span>
			<span class="nx">Flags</span><span class="p">:</span> <span class="nx">flags</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="nx">Data</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span>
	<span class="p">}</span>

	<span class="c1">// Send AUDIT_GET message to the kernel.
</span><span class="c1"></span>	<span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Netlink</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p>For the Status API, the response seems to be fairly simple as seen in the
<a href="https://godoc.org/github.com/elastic/go-libaudit#AuditClient.GetStatus">godoc</a>.</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">AuditClient</span><span class="p">)</span> <span class="nf">GetStatus</span><span class="p">()</span> <span class="p">(</span><span class="o">*</span><span class="nx">AuditStatus</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></div><p>The <a href="https://godoc.org/github.com/elastic/go-libaudit#AuditStatus"><code>AuditStatus</code></a>
contains the following information which is neat because everything is parsed
and presented in a human readable format.</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">AuditStatus</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Mask</span>            <span class="nx">AuditStatusMask</span> <span class="c1">// Bit mask for valid entries.
</span><span class="c1"></span>    <span class="nx">Enabled</span>         <span class="kt">uint32</span>          <span class="c1">// 1 = enabled, 0 = disabled, 2 = immutable
</span><span class="c1"></span>    <span class="nx">Failure</span>         <span class="kt">uint32</span>          <span class="c1">// Failure-to-log action.
</span><span class="c1"></span>    <span class="nx">PID</span>             <span class="kt">uint32</span>          <span class="c1">// PID of auditd process.
</span><span class="c1"></span>    <span class="nx">RateLimit</span>       <span class="kt">uint32</span>          <span class="c1">// Messages rate limit (per second).
</span><span class="c1"></span>    <span class="nx">BacklogLimit</span>    <span class="kt">uint32</span>          <span class="c1">// Waiting messages limit.
</span><span class="c1"></span>    <span class="nx">Lost</span>            <span class="kt">uint32</span>          <span class="c1">// Messages lost.
</span><span class="c1"></span>    <span class="nx">Backlog</span>         <span class="kt">uint32</span>          <span class="c1">// Messages waiting in queue.
</span><span class="c1"></span>    <span class="nx">FeatureBitmap</span>   <span class="kt">uint32</span>          <span class="c1">// Bitmap of kernel audit features (previously to 3.19 it was the audit api version number).
</span><span class="c1"></span>    <span class="nx">BacklogWaitTime</span> <span class="kt">uint32</span>          <span class="c1">// Message queue wait timeout.
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div><p>Now, let&rsquo;s try to read the current installed config using the
<a href="https://godoc.org/github.com/elastic/go-libaudit#AuditClient.GetRules"><code>GetRules</code></a>
API. Notice the signature,</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">AuditClient</span><span class="p">)</span> <span class="nf">GetRules</span><span class="p">()</span> <span class="p">([][]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</code></pre></div><p>Not so fun, right! it&rsquo;s returning a <code>[][]byte</code> which seems to be the raw response
from the socket (headers stripped out obviously). This response can be parsed by
looking at the only trustworthy implementation,
<a href="https://github.com/linux-audit/audit-userspace/blob/dc5c031fc19162fde4d20f4e7cd60f2b26aa8ccc/src/auditctl-listing.c#L159">linux-audit/audit-userspace</a></p>
<p>This involves parsing out the <a href="https://github.com/torvalds/linux/blob/master/include/uapi/linux/audit.h#L503">following struct</a>
from the binary output.</p>
<div class="highlight"><pre class="chroma"><code class="language-C" data-lang="C"><span class="k">struct</span> <span class="n">audit_rule_data</span> <span class="p">{</span>
	<span class="n">__u32</span>		<span class="n">flags</span><span class="p">;</span>	<span class="cm">/* AUDIT_PER_{TASK,CALL}, AUDIT_PREPEND */</span>
	<span class="n">__u32</span>		<span class="n">action</span><span class="p">;</span>	<span class="cm">/* AUDIT_NEVER, AUDIT_POSSIBLE, AUDIT_ALWAYS */</span>
	<span class="n">__u32</span>		<span class="n">field_count</span><span class="p">;</span>
	<span class="n">__u32</span>		<span class="n">mask</span><span class="p">[</span><span class="n">AUDIT_BITMASK_SIZE</span><span class="p">];</span> <span class="cm">/* syscall(s) affected */</span>
	<span class="n">__u32</span>		<span class="n">fields</span><span class="p">[</span><span class="n">AUDIT_MAX_FIELDS</span><span class="p">];</span>
	<span class="n">__u32</span>		<span class="n">values</span><span class="p">[</span><span class="n">AUDIT_MAX_FIELDS</span><span class="p">];</span>
	<span class="n">__u32</span>		<span class="n">fieldflags</span><span class="p">[</span><span class="n">AUDIT_MAX_FIELDS</span><span class="p">];</span>
	<span class="n">__u32</span>		<span class="n">buflen</span><span class="p">;</span>	<span class="cm">/* total length of string fields */</span>
	<span class="kt">char</span>		<span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>	<span class="cm">/* string fields buffer */</span>
<span class="p">};</span>
</code></pre></div><p>A <a href="https://gist.github.com/prateeknischal/91b3c0b891e1c5e4537c7edd38866b82#file-audit_config-go">go implementation</a>
to parse the emitted config (this implementation is not comprehensible)</p>
<h4 id="reading-the-rules-from-the-socket">Reading the rules from the socket</h4>
<p>Creating a new audit client is fairly simple using the go-libaudit package.</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">client</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">libaudit</span><span class="p">.</span><span class="nf">NewAuditClient</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>
<span class="nx">buf</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">GetRules</span><span class="p">()</span>
</code></pre></div><script type="application/javascript" src="https://gist.github.com/prateeknischal/91b3c0b891e1c5e4537c7edd38866b82.js?file=read_rules.go"></script>

<h4 id="extracting-the-rules">Extracting the rules</h4>
<p>The rules are packed in a custom format to be efficient since a lot of these
packets are send across. It&rsquo;s a bit hard to discover what exact values does the
<code>fields</code>, <code>values</code>, <code>masks</code> and <code>fieldflags</code> arrays hold. It can be looked up at
the userspace libaudit codebase at the moment.
<script type="application/javascript" src="https://gist.github.com/prateeknischal/91b3c0b891e1c5e4537c7edd38866b82.js?file=parse_rules.go"></script>
</p>
<h4 id="get-syscall-numbers">Get syscall numbers</h4>
<p>For the rules that establish a rule to record event based on syscalls, the rule
output has an encoded version of syscall number for that kernel in the byte
buffer. Instead of using a <code>vector</code>, it uses a fixed size array of <code>uint32</code> and
each bit represents a syscall number based on their index if they are set. For a
rule that affects all syscalls, it just has all bits set. The max array size at
the moment is 64, so it can represent <code>32 * 64</code> syscalls.
<script type="application/javascript" src="https://gist.github.com/prateeknischal/91b3c0b891e1c5e4537c7edd38866b82.js?file=get_syscall.go"></script>
</p>
<h3 id="running-the-above-code">Running the above code</h3>
<p>All things considered, it can&rsquo;t be done without running it. Making a connection
to the netlink socket is a privileged operation and needs the <code>CAP_AUDIT_CONTROL</code>
capability or an effective uid 0.</p>
<pre><code>$ man 7 capabilities
CAP_AUDIT_CONTROL (since Linux 2.6.11)
      Enable and disable kernel auditing; change auditing filter
      rules; retrieve auditing status and filtering rules.
</code></pre><p>For the rules that are installed</p>
<pre><code>-a always,exit -S execve -F key=pr_ev
-a always,exit -S execveat -F key=pr_ev
-w /etc/audit -p wa -k sys_audit
-w /etc/hosts -p wa -k sys_etc
</code></pre><p>This can be done using</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ go build audit_config.go -o auditparse
$ sudo setcap cap_audit_control+eip auditparse
$ ./auditparse
Rule with key: pr_ev

Rule with key: pr_ev

Rule on directory: /etc/audit
Rule to watch <span class="k">for</span> Permission: Write<span class="p">|</span>Attr
Rule with key: sys_audit

Rule on directory: /etc/hosts
Rule to watch <span class="k">for</span> Permission: Write<span class="p">|</span>Attr
Rule with key: sys_etc
</code></pre></div><hr>
<p>Parsing from bits is always fun.</p>


</div>

<div class="">
    <p>
  Published
  
    
      by <span itemprop="author">open-osquery</span>
    
  
  <time datetime="2020-11-22T17:14:54&#43;05:30">
    22 Nov, 2020
  </time>
  
  
  using <span itemprop="wordCount">1209</span> words.
</p>

    



</div>



</div>
</div>
</main>
  <footer>   <footer id="footer">
    <nav>
      <ul>
        <li><span>Open osquery</span></li>
        <li>
          <a href="/about/">About</a>
        </li>
        <li>
          <a href="/blog/">Blog</a>
        </li>
          <li>
          <a href="/docs/">Docs</a>
        </li>
        <li>
          <a href="https://github.com/open-osquery">Github</a>
        </li>
      </ul>
    </nav>
    <p>&copy; Licence MIT.</p>
  </footer>
 </footer>


  <script src="/js/kube.js" type="text/javascript">
  </script>
  <script src="/js/kube.legenda.js" type="text/javascript">
  </script>
  <script src="/js/master.js" type="text/javascript">
  </script>
</body>

</html>
